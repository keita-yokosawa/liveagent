<html>

  <head>
    <title>CHAT PAGE FOR MEMBER</title>
  </head>

  <body>
	<script type='text/javascript'>

       function embeddedMsgLoaded(iType) {
        var embeddedMsg = document.getElementById('embeddedMessagingModalOverlay');
		//var embeddedMsg = document.getElementById('embeddedMessagingFrame');
		console.log('the iType = ' + iType);
		if(iType == 1){
			console.log('the window is reload!');
		}
	    console.log(embeddedMsg);
        if (!embeddedMsg && iType == 2) {
          window.setTimeout(embeddedMsgLoaded(2), 500);
          return;
        }
		if(embeddedMsg) { 
            console.log('height=' + embeddedMsg.height );
            console.log('clientWidth=' + embeddedMsg.width );
            var height = embeddedMsg.clientHeight + 24;
            var width = embeddedMsg.clientWidth + 36;
		    // var embeddedMsgMV = document.getElementById('embeddedMessagingModalOverlay');
		    // if (!embeddedMsgMV) {
		    // 	embeddedMsgMV.remove();
		    // 	console.log('embeddedMessagingModalOverlay is deleted!');
		    // }
		    embeddedMsg.style.display = 'none';
		    window.parent.postMessage({frameHeight: 480,frameWidth: 321}, '*'); 
		    //embeddedMsg.style.height="100%";
            //window.parent.postMessage({frameHeight: 580,frameWidth: 320}, '*'); 
		}
      }
		
		var crmContractNo;
		var fields = {};
		console.log("crmContractNo: "  + crmContractNo);
		window.addEventListener("onEmbeddedMessagingReady", () => {
	    	console.log("Received the onEmbeddedMessagingReady event…");
	    	console.log("the contractNo is "  + crmContractNo);
	    	if (crmContractNo) {
		  		fields.contractNo = crmContractNo;
			}
			embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields(fields);
		});

		window.addEventListener("onEmbeddedMessagingButtonClicked", () => {
	    	console.log("Fires the first time the chat button is clicked by the end user.…");
	    	console.log("the contractNo is "  + crmContractNo);
　　　　　　　embeddedMsgLoaded(2)
		});
		window.onload=embeddedMsgLoaded(1);
		
		// window.addEventListener("onEmbeddedMessagingWindowMinimized", () => {
	 //    	console.log(" end user clicks the Close (X) button.…");
  //      //      var embeddedMsg = document.getElementById('embeddedMessagingModalOverlay');
	 //      //   console.log(embeddedMsg);
  //      //      if (!embeddedMsg) {
  //      //         window.setTimeout(embeddedMsgLoaded, 500);
  //      //         return;
  //      //       }
  //      //       console.log('height=' + embeddedMsg.clientHeight );
  //      //       console.log('clientWidth=' + embeddedMsg.clientWidth );
  //      //       var height = embeddedMsg.clientHeight + 24;
  //      //       var width = embeddedMsg.clientWidth + 36;
		//      // embeddedMsg.style.display = 'none';
		//      window.parent.postMessage({frameHeight: 180,frameWidth: 180}, '*'); 
		//  });
		
		function initEmbeddedMessaging() {
			try {
				embeddedservice_bootstrap.settings.language = 'ja'; // For example, enter 'en' or 'en-US'

				embeddedservice_bootstrap.init(
					'00D0l0000003gBr',
					'MessagingWebReleaseTest',
					'https://occ-crown--partial.sandbox.my.site.com/ESWMessagingWebRelease',
					{
						scrt2URL: 'https://occ-crown--partial.sandbox.my.salesforce-scrt.com'
					}
				);
			} catch (err) {
				console.error('Error loading Embedded Messaging: ', err);
			}
		};
	</script>
	<script type='text/javascript' src='https://occ-crown--partial.sandbox.my.site.com/ESWMessagingWebRelease/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
  </body>
  
</html>
